# Introduction #

Tuner Studio requires a serial stream to interface with ECU's. For the TRK-MPC5634 dev board, this serial stream needs to be TTL levels. The RN41 is an ideal candidate for such a task.


# Overview #
We'll assume you have Tuner Studio and the TRK-MPC5634 board installed and working with o5e firmware. You might even have a TTL USB cable connected and working. The scope here will be limited to just the connection via wireless device. Also we'll assume you are working with a Windows machine, in this case I used Windows 7 64bit.

## Key information ##
You'll have to make sure that Tuner Studio is using the correct port settings. In the firmware file for o5e I found config.h was set like this#define BAUD\_RATE 115200 then in eSCI\_OPS.c I see it's 8 data bits, no parity, 1 stop bit and no flow control. I also see it's for ESCI\_A which on the TRK-MPC5634 is P8 pins 1 and 2.

At the time of writing this, the RN41 can be obtained for $25 from here https://www.sparkfun.com/products/8497, if you need something a bit easier to work with, there is a thru hole version found here https://www.sparkfun.com/products/11600 for $30. The thru hole version will likely be handy for many people, as it includes an input cap, and some other components that make it easier to work with.

If you don't have Bluetooth, you're going to need it. Here is the USB device I used https://www.sparkfun.com/products/9434.

## Connecting the RN41 for the first time ##
  * If required plug in your USB Bluetooth device into the computer. This will download and install the required drivers for the device.
  * The dev board provides 3.3V and GND on the header in the top right of the board. Connect GND to pin 12, and 3.3V to pin 11. This will power up the RN41.
  * On your computer, open the "Bluetooth Devices" thing often found in the bottom right near the clock. Then select show Bluetooth devices. You probably do not show this new device, you'll have to add it.
  * Click "add a device" It should find an unknown device. That's probably the one so add it. It will want to download and install some drivers as it does this. If asked choose to do this with out pairs.
  * At this point, it might be good to reboot. Mine has some yellow warning in the device manager, however they went away after a reboot. Mine was also Windows 64, which is virtual-ized, so it might have some additional oddities not normally seen.
  * Open the Devices and Printers thing, you should see the FireFly-XXXX, right click it and choose properties. Then under the hardware tab find the COM port number.
  * As luck has it, the default/OEM settings for the RN41 are 11520/8/n/1 which matches o5e. The first thing we'll want to do is to ensure you can connect to the device. Well do this with Putty, I had version .62.
  1. Open Putty.
  1. It usually opens in the session window. Here choose "serial" then set the COM# (in my case it's COM18) as well set the baud to 115200.
  1. Now on the left choose "Terminal" then under "local echo" choose "Force on" The RN41 does not echo by default, this will allow you to know that you have hit typed characters in Putty when the time comes.
  1. Now under "connection" choose "Serial". Here you will set data bits 8, stop bits 1 parity none, flow control none. Baud should have already been set as you entered it in the session page.
  1. Now go back to the session page type a name like RN41 and hit save. This will entered
  1. Click "Open" and you should get a black window.
  1. The first time you do this, you may be asked for a code or something, in this case the default is "1234" This should allow you to connect and get that black window noted above.
  1. Power cycle the RN41 by pulling and re-connecting it's 3.3V power. For 60 seconds after this, you can enter command mode instead of data mode. This is done by first allowing 1 second with no bits of data, followed by $$$ and again followed by a brief delay with no bits.
  1. Type "$$$" you should quite quickly see CMD. You see the $$$ because of the local echo, then CMD is generated by the RN41. You don't want to change anything, you just want to see it's communicating. Now type "---" and hit enter. You should see END show up. This means you are back in data mode, and that you have established a connection with the RN41.
  1. Connect the RN41 pin ?? TX found in the bottom right of the RN41, to dev board P8 pin 2, and RNA41 pin ?? RX found in the bottom right of the RN41, to dev board P8 pin 1
  1. Putty at this point is locked into data mode. If you type "S" you should get a reply similar to gc 1.0.0 A command of S means to return the version number. If you get this, you have successfully connected, if you don't get the reply, try flipping the RX and TX, then try again.
  1. Now finally, open Tuner Studio, using the file found in the repo under open5xxxecu.firmware\o5e\Tuner, when it opens it will probably complain about COM4. Select yes, and TS will open, then choose the "commuications" --> "Settings" and change to the COM port used by the RN41 and 115200. The test did NOT work for me, however TS did work. Click Accept to get out of this. You may have to restart TS to get it to go on-line.

Now when you open TS, it should start off-line, then after a second or two, it will connect, and a bar will scroll across your screen. It will eventually show gauges that are not grey-ish. This means you are connected.

Enjoy.

Some other notes, I had some stability issues, TS would go grey after some 30 seconds to a minute, I believe I'm experiencing a loss of packets, and TS is going off-line as a result. I have smashed this pretty hard, so it could be lots of things and I'm still looking at it closer. For example I know I should have a cap on the 3.3V at the RN41, but I don't now, so that could be the issue. I put this up there before I forgot the basic steps and details.